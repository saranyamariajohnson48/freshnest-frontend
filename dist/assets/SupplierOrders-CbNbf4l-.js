import{u as S,r as l,m as D,j as e,F,n as O,o as A,p as E,q as T}from"./index-DWA34nyN.js";import{o as h}from"./orderService-BlMie31S.js";const i=["Biscuits Pack","Noodles Pack","Chips Pack","Chocolate Pack","Juice Pack"],y={"Biscuits Pack":"Biscuits Pack","Noodles Pack":"Noodles Pack","Chips Pack":"Chips Pack","Chocolate / Candy Pack":"Chocolate Pack","Juice / Tetra Pack":"Juice Pack"};function B(){const{success:b,error:o}=S(),[m,p]=l.useState([]),[d,N]=l.useState("all"),[f,u]=l.useState(!1),[x,w]=l.useState([]),[P,C]=l.useState([]),[a,n]=l.useState({category:i[0],brand:"",pricePerQuantity:"",quantity:1,expectedDelivery:"",notes:""});l.useEffect(()=>{(async()=>{try{const s=await h.list(d==="all"?{}:{status:d});p(s.data||s.orders||[])}catch(s){o(s.message||"Failed to load orders")}})()},[d,o]),l.useEffect(()=>{(async()=>{try{const r=(await T.list({limit:200})).data?.items||[];w(r)}catch{}})()},[]),l.useEffect(()=>{const t=D(y[a.category]||a.category),s=Array.from(new Set(x.filter(c=>(y[c.category]||c.category)===a.category).map(c=>c.brand).filter(Boolean))),r=Array.from(new Set([...t||[],...s]));C(r)},[a.category,x]),l.useMemo(()=>{const t={};for(const s of i)t[s]=[];for(const s of x){const r=y[s.category]||s.category;i.includes(r)&&t[r].push(s)}return t},[x]);const k=async t=>{t.preventDefault();try{if(!a.pricePerQuantity||Number(a.pricePerQuantity)<0)throw new Error("Please enter a valid price per quantity");const s={category:a.category,brand:a.brand||void 0,pricePerQuantity:Number(a.pricePerQuantity),quantity:Number(a.quantity),expectedDelivery:new Date(a.expectedDelivery).toISOString(),notes:a.notes},r=await h.create(s);b("Order created"),u(!1),n({category:i[0],brand:"",pricePerQuantity:"",quantity:1,expectedDelivery:"",notes:""}),p(c=>[r.data,...c])}catch(s){o(s.message||"Failed to create order")}},j=async(t,s)=>{try{const r=await h.updateStatus(t,s);p(c=>c.map(v=>v._id===t?r.data:v)),b("Status updated")}catch(r){o(r.message||"Failed to update status")}},g=l.useMemo(()=>d==="all"?m:m.filter(t=>t.status===d),[m,d]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-slate-200 rounded-2xl p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Orders"}),e.jsx("p",{className:"text-slate-700 text-sm",children:"Create and track your orders to warehouse"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:d,onChange:t=>N(t.target.value),className:"appearance-none bg-white border border-slate-300 rounded-lg px-4 py-2 pr-8 text-slate-800",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"In Transit",children:"In Transit"}),e.jsx("option",{value:"Delivered",children:"Delivered"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]}),e.jsx(F,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700",children:[e.jsx(O,{className:"w-4 h-4"})," New Order"]})]})]}),e.jsx("div",{className:"bg-white border border-slate-200 rounded-2xl p-6 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-slate-700",children:[e.jsx("th",{className:"py-2",children:"Order ID"}),e.jsx("th",{className:"py-2",children:"Brand"}),e.jsx("th",{className:"py-2",children:"Qty"}),e.jsx("th",{className:"py-2",children:"Status"}),e.jsx("th",{className:"py-2",children:"Date"}),e.jsx("th",{className:"py-2",children:"Actions"})]})}),e.jsxs("tbody",{children:[g.map(t=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-slate-200 text-slate-800",children:[e.jsx("td",{className:"py-2",children:t._id.slice(-6)}),e.jsx("td",{className:"py-2",children:t.brand||t.product||"-"}),e.jsx("td",{className:"py-2",children:t.quantity}),e.jsx("td",{className:"py-2",children:t.status}),e.jsx("td",{className:"py-2",children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"py-2 space-x-2",children:[t.status==="Pending"&&e.jsx("button",{onClick:()=>j(t._id,"In Transit"),className:"px-3 py-1 text-xs bg-blue-50 text-blue-700 rounded",children:"Mark In Transit"}),t.status==="In Transit"&&e.jsx("button",{onClick:()=>j(t._id,"Delivered"),className:"px-3 py-1 text-xs bg-emerald-50 text-emerald-700 rounded",children:"Mark Delivered"})]})]},t._id),t.status==="Delivered"&&t.adminConfirmed&&e.jsx("tr",{className:"border-t border-emerald-100",children:e.jsx("td",{colSpan:"6",className:"py-2",children:e.jsxs("div",{className:"rounded-lg border border-emerald-200 bg-emerald-50 p-3 text-emerald-800 flex items-start gap-2",children:[e.jsx(A,{className:"mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Delivery confirmed by Admin"}),e.jsxs("div",{className:"text-sm",children:["Shipment has reached the warehouse ",t.adminConfirmedAt?`on ${new Date(t.adminConfirmedAt).toLocaleDateString()}`:"","."]})]})]})})})]})),g.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center text-slate-700 py-8",children:"No orders found"})})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Create New Order"}),e.jsx("button",{onClick:()=>u(!1),className:"p-2 hover:bg-slate-100 rounded",children:e.jsx(E,{})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Category"}),e.jsx("select",{value:a.category,onChange:t=>n(s=>({...s,category:t.target.value,product:""})),className:"w-full border border-slate-300 rounded-lg px-3 py-2",children:i.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Brand"}),e.jsxs("select",{value:a.brand,onChange:t=>n(s=>({...s,brand:t.target.value})),className:"w-full border border-slate-300 rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"Select a brand"}),P.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Price per quantity"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:a.pricePerQuantity,onChange:t=>n(s=>({...s,pricePerQuantity:t.target.value})),className:"w-full border border-slate-300 rounded-lg px-3 py-2",placeholder:"e.g. 10.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:1,value:a.quantity,onChange:t=>n(s=>({...s,quantity:t.target.value})),className:"w-full border border-slate-300 rounded-lg px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Expected Delivery Date"}),e.jsx("input",{type:"date",value:a.expectedDelivery,onChange:t=>n(s=>({...s,expectedDelivery:t.target.value})),className:"w-full border border-slate-300 rounded-lg px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:a.notes,onChange:t=>n(s=>({...s,notes:t.target.value})),className:"w-full border border-slate-300 rounded-lg px-3 py-2",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-4 py-2 border border-slate-300 rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-emerald-600 text-white rounded-lg",children:"Create Order"})]})]})]})})]})}export{B as default};
